<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Tradutor Profissional">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="description" content="Tradutor profissional com reconhecimento de voz, s√≠ntese de voz offline, 75+ idiomas e suporte offline completo.">
    
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIlRyYWR1dG9yIFByb2Zpc3Npb25hbCIsCiAgInNob3J0X25hbWUiOiAiVHJhZHV0b3IiLAogICJzdGFydF91cmwiOiAiLi8iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiMwZjE3MmEiLAogICJ0aGVtZV9jb2xvciI6ICIjMGYxNzJhIiwKICAiaWNvbnMiOiBbCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sLDxzdmcgeG1sbnM9J2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyB2aWV3Qm94PScwIDAgMTkyIDE5Mic+PGRlZnM+PGxpbmVhckdyYWRpZW50IGlkPSdncmFkJyB4MT0nMCUnIHkxPScwJScenterMj0nMTAwJScgeTI9JzEwMCUnPjxzdG9wIG9mZnNldD0nMCUnIHN0eWxlPSdzdG9wLWNvbG9yOiUyMzBmMTcyYTtzdG9wLW9wYWNpdHk6MScgLz48c3RvcCBvZmZzZXQ9JzEwMCUnIHN0eWxlPSdzdG9wLWNvbG9yOiUyMzAwMWE0ZDtzdG9wLW9wYWNpdHk6MScgLz48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48cmVjdCBmaWxsPSd1cmwoJTIzZ3JhZCknIHdpZHRoPScxOTInIGhlaWdodD0nMTkyJyByeD0nNDUnLz48dGV4dCB4PSc1MCUnIHk9JzUwJScgZm9udC1zaXplPSc5MCcgZmlsbD0nJTIzNjBhNWZhJyB0ZXh0LWFuY2hvcj0nbWlkZGxlJyBkb21pbmFudC1iYXNlbGluZT0nbWlkZGxlJyBmb250LWZhbWlseT0nQXJpYWwnIGZvbnQtd2VpZ2h0PSdib2xkJz5UPC90ZXh0Pjwvc3ZnPiIsCiAgICAgICJzaXplcyI6ICIxOTJ4MTkyIiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIKICAgIH0KICBdCn0=">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><defs><linearGradient id='grad' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' style='stop-color:%230f172a;stop-opacity:1' /><stop offset='100%' style='stop-color:%23001a4d;stop-opacity:1' /></linearGradient></defs><rect fill='url(%23grad)' width='192' height='192' rx='45'/><text x='50%' y='50%' font-size='90' fill='%2360a5fa' text-anchor='middle' dominant-baseline='middle' font-family='Arial' font-weight='bold'>T</text></svg>">
    
    <title>Tradutor Profissional - 75+ Idiomas (Modo Offline)</title>
    
    <style>
        /* CSS base mantido para consist√™ncia visual */
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-user-select: none; user-select: none; }
        html, body { width: 100%; height: 100%; overflow: hidden; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #001a4d 0%, #0f172a 50%, #001a4d 100%); color: #f0f4f8; display: flex; flex-direction: column; }
        .container { flex: 1; overflow-y: auto; display: flex; flex-direction: column; }
        .header { background: linear-gradient(135deg, #0f172a 0%, #1a2a4a 100%); padding: 1.5rem 1rem; text-align: center; border-bottom: 1px solid rgba(96, 165, 250, 0.2); }
        .header h1 { font-size: 1.5rem; color: #60a5fa; }
        .status-bar { display: flex; gap: 0.5rem; justify-content: center; margin-top: 0.5rem; }
        .status-indicator { display: flex; align-items: center; gap: 0.5rem; padding: 0.3rem 0.7rem; border-radius: 20px; font-size: 0.7rem; background: rgba(96, 165, 250, 0.1); }
        .status-indicator.online { color: #86efac; border: 1px solid #22c55e; }
        .status-indicator.offline { color: #fca5a5; border: 1px solid #ef4444; }
        .content { flex: 1; padding: 1rem; display: flex; flex-direction: column; gap: 1rem; }
        .card { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(10px); border-radius: 1rem; padding: 1rem; border: 1px solid rgba(96, 165, 250, 0.1); }
        textarea { width: 100%; background: transparent; border: none; color: white; font-size: 1.1rem; resize: none; min-height: 100px; outline: none; }
        .output-text { min-height: 100px; font-size: 1.1rem; color: #60a5fa; }
        .btn-row { display: flex; gap: 0.5rem; margin-top: 1rem; }
        button { flex: 1; padding: 0.8rem; border-radius: 0.5rem; border: none; background: #3b82f6; color: white; font-weight: bold; cursor: pointer; }
        button.secondary { background: #334155; }
        .language-selector { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; background: rgba(30, 41, 59, 0.5); padding: 0.5rem; border-radius: 0.5rem; }
        .lang-btn { background: transparent; color: #e2e8f0; font-size: 0.9rem; }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background: #1e293b; padding: 2rem; border-radius: 1rem; text-align: center; max-width: 80%; }
        .offline-notice { font-size: 0.7rem; color: #94a3b8; margin-top: 0.5rem; font-style: italic; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Tradutor Profissional</h1>
            <div class="status-bar">
                <div id="statusIndicator" class="status-indicator online">
                    <span id="statusText">Online</span>
                </div>
                <button class="voice-selector-btn" onclick="showVoiceSelector()" style="flex:none; padding: 0.3rem 0.7rem;">
                    <span id="voiceIcon">üë©‚Äçüé§</span> Voz
                </button>
            </div>
        </div>

        <div class="content">
            <div class="card">
                <div class="language-selector">
                    <span id="sourceName">Portugu√™s</span>
                    <button class="lang-btn" onclick="swapLanguages()">‚áÑ</button>
                    <span id="targetName">Ingl√™s</span>
                </div>
                <textarea id="inputText" placeholder="Digite ou fale aqui..." oninput="translateText()"></textarea>
                <div class="btn-row">
                    <button id="micBtn" onclick="toggleMicrophone()">üé§ FALAR</button>
                    <button class="secondary" onclick="clearInput()">‚úï LIMPAR</button>
                </div>
            </div>

            <div class="card">
                <div id="outputText" class="output-text">Tradu√ß√£o aparecer√° aqui...</div>
                <div class="btn-row">
                    <button id="speakBtn" onclick="speakTranslation()">üîä OUVIR</button>
                    <button class="secondary" onclick="copyTranslation()">üìã COPIAR</button>
                </div>
                <div class="offline-notice">As tradu√ß√µes novas requerem internet, mas as repetidas funcionam offline. A voz funciona sempre!</div>
            </div>
        </div>
    </div>

    <div id="voiceModal" class="modal">
        <div class="modal-content">
            <h2>Escolha sua Voz</h2>
            <div class="btn-row">
                <button onclick="selectVoice('male')">üë®‚Äçüé§ Grave</button>
                <button onclick="selectVoice('female')">üë©‚Äçüé§ Aguda</button>
            </div>
        </div>
    </div>

    <script>
        // Configura√ß√µes e Estado
        let sourceLanguage = 'pt-BR';
        let targetLanguage = 'en-US';
        let voiceGender = 'female';
        let isListening = false;
        let isSpeaking = false;
        
        // Cache Local Persistente (LocalStorage)
        let translationCache = JSON.parse(localStorage.getItem('translationCache') || '{}');

        function saveCache() {
            localStorage.setItem('translationCache', JSON.stringify(translationCache));
        }

        // Inicializa√ß√£o
        function init() {
            updateStatusIndicator();
            window.addEventListener('online', updateStatusIndicator);
            window.addEventListener('offline', updateStatusIndicator);
            
            // Registrar Service Worker para PWA Offline
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js').catch(() => {});
            }
        }

        function updateStatusIndicator() {
            const indicator = document.getElementById('statusIndicator');
            const text = document.getElementById('statusText');
            if (navigator.onLine) {
                indicator.className = 'status-indicator online';
                text.textContent = 'Online';
            } else {
                indicator.className = 'status-indicator offline';
                text.textContent = 'Modo Offline Ativo';
            }
        }

        // Voz e Fala (Offline via Web Speech API)
        function selectVoice(gender) {
            voiceGender = gender;
            document.getElementById('voiceIcon').textContent = gender === 'male' ? 'üë®‚Äçüé§' : 'üë©‚Äçüé§';
            document.getElementById('voiceModal').style.display = 'none';
            localStorage.setItem('voiceGender', gender);
        }

        function showVoiceSelector() {
            document.getElementById('voiceModal').style.display = 'flex';
        }

        function speakTranslation() {
            const text = document.getElementById('outputText').textContent;
            if (!text || text === 'Tradu√ß√£o aparecer√° aqui...') return;

            const synth = window.speechSynthesis;
            if (synth.speaking) {
                synth.cancel();
                isSpeaking = false;
                document.getElementById('speakBtn').classList.remove('speaking');
                return;
            }

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = targetLanguage;
            
            // Tenta encontrar a voz ideal no sistema
            const voices = synth.getVoices();
            const targetPrefix = targetLanguage.split('-')[0];
            let voice = voices.find(v => v.lang.startsWith(targetPrefix) && 
                (voiceGender === 'male' ? !v.name.includes('female') : v.name.includes('female')));
            
            if (!voice) voice = voices.find(v => v.lang.startsWith(targetPrefix));
            if (voice) utterance.voice = voice;

            utterance.onstart = () => document.getElementById('speakBtn').style.background = '#ef4444';
            utterance.onend = () => document.getElementById('speakBtn').style.background = '#3b82f6';
            
            synth.speak(utterance);
        }

        // Tradu√ß√£o com Cache Local
        function translateText() {
            const text = document.getElementById('inputText').value.trim();
            const output = document.getElementById('outputText');
            
            if (!text) {
                output.textContent = 'Tradu√ß√£o aparecer√° aqui...';
                return;
            }

            const cacheKey = `${sourceLanguage}|${targetLanguage}|${text.toLowerCase()}`;
            
            // 1. Tenta o Cache (Funciona Offline!)
            if (translationCache[cacheKey]) {
                output.textContent = translationCache[cacheKey];
                return;
            }

            // 2. Se estiver Offline e n√£o tiver no cache
            if (!navigator.onLine) {
                output.textContent = "[Sem internet para novas tradu√ß√µes]";
                return;
            }

            // 3. Se estiver Online, busca na API
            fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=${sourceLanguage}|${targetLanguage}`)
                .then(r => r.json())
                .then(data => {
                    const translated = data.responseData.translatedText;
                    output.textContent = translated;
                    // Salva no cache para uso offline futuro
                    translationCache[cacheKey] = translated;
                    saveCache();
                })
                .catch(() => {
                    output.textContent = "Erro ao traduzir...";
                });
        }

        // Reconhecimento de Voz
        function toggleMicrophone() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) return alert("Microfone n√£o suportado neste navegador.");

            const recognition = new SpeechRecognition();
            recognition.lang = sourceLanguage;
            
            recognition.onstart = () => {
                document.getElementById('micBtn').style.background = '#ef4444';
                document.getElementById('micBtn').textContent = 'üõë PARAR';
            };
            
            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                document.getElementById('inputText').value = transcript;
                translateText();
            };
            
            recognition.onend = () => {
                document.getElementById('micBtn').style.background = '#3b82f6';
                document.getElementById('micBtn').textContent = 'üé§ FALAR';
            };

            recognition.start();
        }

        // Utilidades
        function clearInput() {
            document.getElementById('inputText').value = '';
            translateText();
        }

        function copyTranslation() {
            const text = document.getElementById('outputText').textContent;
            if (text && text !== 'Tradu√ß√£o aparecer√° aqui...') {
                navigator.clipboard.writeText(text).then(() => alert("Copiado!"));
            }
        }

        function swapLanguages() {
            [sourceLanguage, targetLanguage] = [targetLanguage, sourceLanguage];
            document.getElementById('sourceName').textContent = sourceLanguage === 'pt-BR' ? 'Portugu√™s' : 'Ingl√™s';
            document.getElementById('targetName').textContent = targetLanguage === 'en-US' ? 'Ingl√™s' : 'Portugu√™s';
            const input = document.getElementById('inputText').value;
            const output = document.getElementById('outputText').textContent;
            document.getElementById('inputText').value = output === 'Tradu√ß√£o aparecer√° aqui...' ? '' : output;
            translateText();
        }

        window.addEventListener('load', () => {
            const savedVoice = localStorage.getItem('voiceGender');
            if (savedVoice) selectVoice(savedVoice);
            else showVoiceSelector();
        });

        init();
    </script>
</body>
</html>
